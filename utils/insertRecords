const axios = require("axios");

const API_BASE_URL = "http://localhost:8000"; // Change if your server runs on a different port

/**
 * Registers a new user by sending a POST request to the users route.
 * @param {Object} userData - The user details.
 */
const registerUser = async (userData) => {
  try {
    const response = await axios.post(`${API_BASE_URL}/users`, userData);
    console.log("User created successfully:", response.data);
    return response.data;
  } catch (error) {
    console.error("Error creating user:", error.response?.data || error.message);
    throw error;
  }
};

/**
 * Creates a new card by sending a POST request to the cards route.
 * @param {Object} cardData - The card details.
 */
const createCard = async (cardData) => {
  try {
    const response = await axios.post(`${API_BASE_URL}/cards`, cardData);
    console.log("Card created successfully:", response.data);
    return response.data;
  } catch (error) {
    console.error("Error creating card:", error.response?.data || error.message);
    throw error;
  }
};

// Example usage:
const userPayload = {
  name: {
    first: "first",
    middle: "",
    last: "user",
  },
  isBusiness: true,
  phone: "050-0000000",
  email: "first@gmail.com",
  password: "Aa1234!",
  address: {
    state: "",
    country: "israel",
    city: "tel-aviv",
    street: "magnive",
    houseNumber: 5,
  },
  image: {
    url: "",
    alt: "",
  },
};

const cardPayload = {
  title: "test123",
  subtitle: "testing",
  description: "testing 123",
  phone: "050-0000000",
  email: "testing@gmail.com",
  web: "https://www.test.co.il",
  image: {
    url: "",
    alt: "",
  },
  address: {
    state: "",
    country: "test",
    city: "test",
    street: "test",
    houseNumber: 3,
    zip: "0",
  },
};

// Call the functions to create a user and a card
(async () => {
  try {
    const newUser = await registerUser(userPayload);
    console.log("Created User:", newUser);

    const newCard = await createCard(cardPayload);
    console.log("Created Card:", newCard);
  } catch (error) {
    console.error("Error:", error.message);
  }
})();

module.exports = { registerUser, createCard };
